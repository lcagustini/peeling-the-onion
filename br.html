<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">

        <title>Peeling The Onion</title>
        <link rel="shortcut icon" href="/logo.png">
        <link rel="stylesheet" type="text/css" href="main.css">
    </head>

    <body>
        <div class="container">
            <div class="title">
                <div>
                    <span>Qual notícia é verdadeira?</span>
                </div>
                <div>
                    <span id="score"></span><span>/</span><span id="total"></span>
                </div>
            </div>
            <div id="left" class="option left-panel" onclick="clickLeft()">
                <div class="text"></div>
            </div>
            <div id="right" class="option right-panel" onclick="clickRight()">
                <div class="text"></div>
            </div>
        </div>
    </body>

    <script>
        let rand = 0;
        let score = 0;
        let total = 0;

        function generateRandomInteger(min, max) {
            return Math.floor(min + Math.random()*(max + 1 - min))
        }

        var getJSON = function(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
                var status = xhr.status;
                if (status === 200) {
                    callback(null, xhr.response);
                } else {
                    callback(status, xhr.response);
                }
            };
            xhr.send();
        };

        var clickLeft = function() {
            if (rand === 0) {
                score += 1;
            }
            total += 1;
            nextPair();
        }

        var clickRight = function() {
            if (rand === 1) {
                score += 1;
            }
            total += 1;
            nextPair();
        }

        function nextPair() {
            document.getElementById("score").innerHTML = score.toString();
            document.getElementById("total").innerHTML = total.toString();

            rand = generateRandomInteger(0, 1);

            //Truth
            getJSON('surrealista.json',
                function(err, data) {
                    if (err !== null) {
                        alert('Something went wrong: ' + err);
                    }
                    else {
                        let random = generateRandomInteger(0, data.length-1);
                        if (rand === 0) {
                            document.getElementById("left").firstElementChild.innerHTML = data[random].title.toLowerCase().replace("(vídeo)", "");
                        }
                        else {
                            document.getElementById("right").firstElementChild.innerHTML = data[random].title.toLowerCase().replace("(vídeo)", "");
                        }
                    }
                });

            //Lie
            getJSON('sensacionalista.json',
                function(err, data) {
                    if (err !== null) {
                        alert('Something went wrong: ' + err);
                    }
                    else {
                        let random = generateRandomInteger(0, data.length-1);
                        if (rand === 0) {
                            document.getElementById("right").firstElementChild.innerHTML = data[random].title.toLowerCase();
                        }
                        else {
                            document.getElementById("left").firstElementChild.innerHTML = data[random].title.toLowerCase();
                        }
                    }
                });
        }

        nextPair();
    </script>
</html>
